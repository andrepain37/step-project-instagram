(this["webpackJsonpstep-project"]=this["webpackJsonpstep-project"]||[]).push([[0],{169:function(e,t,a){},293:function(e,t,a){"use strict";a.r(t);var n=a(2),c=a(0),s=a.n(c),r=a(12),o=a.n(r),i=(a(169),a(170),a(357)),l=a(9),u=a(341),d=a(154),j=a(340),b=a(342);var O=function(){return Object(n.jsxs)("div",{className:"logo",children:[Object(n.jsx)("span",{className:"logo-left logo-side",children:"Mono"}),Object(n.jsx)("span",{className:"logo-right logo-side",children:"Photos"})]})},m=a(8),p=a(19),f=a.n(p),h=a(16),x=a.n(h),g=function(){return function(e,t){var a=t().posts,n=a.posts,c=a.page;a.hasMore&&x.a.post("/posts",{page:c}).then((function(t){t.data?e(function(e){return{type:"LOAD_POSTS",payload:e}}(n.concat(t.data))):e(function(e){return{type:"SAVE_HAS_MORE",payload:e}}(!1))}))}},v=function(e){return function(t){t(function(e){return function(t,a){x.a.post("/posts/one",{postId:e}).then((function(e){e.data&&t({type:"ACTIVATE_POST",payload:e.data})}))}}(e)),t({type:"ACTIVE_POST_DETAILS"})}},y=a(6),_=function(e){return{type:"SEND_LOGIN",payload:e}},S=a(360),E=a(43);var C=function(){var e=Object(m.c)();Object(c.useEffect)((function(){e((function(e,t){t().user.isAuth&&x.a.post("/auth/check",{withCredentials:!0}).then((function(t){t.data?e(_(t.data.user)):e({type:"SEND_LOGOUT"})}))}))}),[e]);var t=Object(c.useState)(null),a=Object(l.a)(t,2),s=a[0],r=a[1],o=function(){r(null)},i=Object(m.d)((function(e){return e.user.isLogin})),p=Object(m.d)((function(e){return e.user.user_info}));return Object(n.jsxs)("header",{children:[Object(n.jsx)(E.b,{to:"/",children:Object(n.jsx)(O,{})}),Object(n.jsxs)("div",{className:"header-nav-info",children:[i&&Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(E.b,{to:"/user/"+p._id,children:Object(n.jsx)(S.a,{"aria-label":"recipe",src:p.image,className:"avatar",children:p.nickname[0]})}),Object(n.jsxs)(d.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:!!s,onClose:o,children:[Object(n.jsx)(j.a,{onClick:function(){r(null),e((function(e){e({type:"ACTIVE_UPLOAD_USER_AVATAR"})}))},children:"\u041f\u043e\u043c\u0435\u043d\u044f\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440"}),Object(n.jsx)(j.a,{onClick:function(){r(null),e((function(e){e({type:"ACTIVE_UPLOAD_POST"})}))},children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043e\u0441\u0442"}),Object(n.jsx)(j.a,{onClick:function(){r(null),e((function(e){x.a.post("/auth/logout").then((function(){e({type:"SEND_LOGOUT"}),e({type:"DELETE_POSTS"}),e({type:"CLEAR_SUBS"})}))}))},children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),!i&&Object(n.jsxs)(d.a,{id:"simple-menu",anchorEl:s,keepMounted:!0,open:!!s,onClose:o,children:[Object(n.jsx)(j.a,{onClick:function(){r(null),e((function(e){e({type:"ACTIVE_LOGIN"})}))},children:"\u0412\u043e\u0439\u0442\u0438"}),Object(n.jsx)(j.a,{onClick:function(){r(null),e((function(e){e({type:"ACTIVE_REGISTER"})}))},children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]}),Object(n.jsx)(u.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){r(e.currentTarget)},children:Object(n.jsx)(b.a,{})})]})]})},A=a(31),L=a(24),k=/\S+@\S+\.\S+/,N="\u041f\u043e\u043b\u0435 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c",T=L.a().shape({nickname:L.c().required(N).min(3,"\u0423 \u043d\u0438\u043a\u043d\u0435\u0439\u043c\u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0438\u043d\u0438\u043c\u0443\u043c 3 \u0441\u0438\u043c\u0432\u043e\u043b\u0430").max(20,"\u0423 \u043d\u0438\u043a\u043d\u0435\u0439\u043c\u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c 20 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),email:L.c().required(N).matches(k,"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u0439 Email \u043d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439!"),password:L.c().required(N),repeat:L.c().required(N).oneOf([L.b("password"),null],"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442!")}),I=a(295),w=a(87),P=a(358);var D=function(e){var t=e.label,a=e.name,c=e.classes,s=Object(w.a)(e,["label","name","classes"]),r=Object(A.b)(a),o=Object(l.a)(r,2),i=o[0],u=o[1];return Object(n.jsx)(n.Fragment,{children:Object(n.jsx)(P.a,Object(y.a)(Object(y.a)({id:"outlined-password-input",error:u.touched&&!!u.error,label:t,name:a,helperText:u.touched&&u.error,className:c},i),s))})};var V=Object(m.b)(null,(function(e){return{sendReg:function(t){return e(function(e){var t=e.values,a=e.setError;return function(e){x.a.post("/auth/register",Object(y.a)({},t)).then((function(t){if(t.data.error)for(var n in t.data.error)a(n,t.data.error[n]),f.a.error(t.data.error[n]);t.data.success&&(e((function(e,t){var a=t().modals;for(var n in a)a[n]=!1;e({type:"CLOSE_ALL",payload:a})})),f.a.success(t.data.success))}))}}(t))}}}))(Object(A.c)({mapPropsToValues:function(){return{nickname:"",email:"",password:"",repeat:""}},handleSubmit:function(e,t){var a=t.props,n={values:e,setError:t.setFieldError};a.sendReg(n)},validationSchema:T})((function(){return Object(n.jsx)(I.a,{children:Object(n.jsxs)(A.a,{noValidate:!0,autoComplete:"off",className:"modal-form",children:[Object(n.jsx)("h3",{className:"modal-form-title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(n.jsx)(D,{label:"\u0412\u0430\u0448 \u043d\u0438\u043a\u043d\u0435\u0439\u043c",name:"nickname",type:"text"}),Object(n.jsx)(D,{label:"\u0412\u0430\u0448 email",name:"email",type:"text"}),Object(n.jsx)(D,{label:"\u0412\u0430\u0448 \u043f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password"}),Object(n.jsx)(D,{label:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",name:"repeat",type:"password"}),Object(n.jsx)(u.a,{color:"primary",type:"submit",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})})}))),M="\u041f\u043e\u043b\u0435 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c",R=L.a().shape({email:L.c().required(M).matches(k,"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u0439 Email \u043d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439!"),password:L.c().required(M)});var U=Object(m.b)(null,(function(e){return{sendLog:function(t){return e(function(e){var t=e.values,a=e.setError;return function(e){x.a.post("/auth/login",Object(y.a)({},t)).then((function(t){if(t.data.error)for(var n in t.data.error)a(n,t.data.error[n]),f.a.error(t.data.error[n]);t.data.success&&(e((function(e,t){var a=t().modals;for(var n in a)a[n]=!1;e({type:"CLOSE_ALL",payload:a})})),e(_(t.data.user)),f.a.success(t.data.success),e({type:"DELETE_POSTS"}))}))}}(t))}}}))(Object(A.c)({mapPropsToValues:function(){return{email:"",password:""}},handleSubmit:function(e,t){var a=t.props,n={values:e,setError:t.setFieldError};a.sendLog(n)},validationSchema:R})((function(){return Object(n.jsx)(I.a,{children:Object(n.jsxs)(A.a,{noValidate:!0,autoComplete:"off",className:"modal-form",children:[Object(n.jsx)("h3",{className:"modal-form-title",children:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"}),Object(n.jsx)(D,{label:"\u0412\u0430\u0448 email",name:"email",type:"text"}),Object(n.jsx)(D,{label:"\u0412\u0430\u0448 \u043f\u0430\u0440\u043e\u043b\u044c",name:"password",type:"password"}),Object(n.jsx)(u.a,{color:"primary",type:"submit",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})})}))),B=a(343),G=a(344);var q=function(){var e=Object(m.d)((function(e){return e.user.isLogin})),t=Object(c.useState)(null),a=Object(l.a)(t,2),s=a[0],r=a[1],o=Object(c.useState)(null),i=Object(l.a)(o,2),d=i[0],j=i[1],b=Object(m.c)(),O=Object(c.useRef)(null);return e?Object(n.jsxs)(I.a,{children:[Object(n.jsx)("h3",{className:"modal-form-title",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043e\u0441\u0442!"}),Object(n.jsxs)("div",{className:"modal-form-post",children:[Object(n.jsx)(u.a,{onClick:function(){O.current.click()},variant:"contained",color:"default",startIcon:Object(n.jsx)(B.a,{}),children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"}),Object(n.jsx)("input",{ref:O,style:{display:"none"},name:"upload_post",id:"upload_post",type:"file",onChange:function(e){var t=window.URL.createObjectURL(e.target.files[0]);r(e.target.files[0]),j(t)}}),d&&s&&Object(n.jsxs)("div",{className:"modal-form-post__preview",children:[Object(n.jsx)(u.a,{variant:"contained",color:"primary",startIcon:Object(n.jsx)(G.a,{}),onClick:function(){b(function(e){return function(){var t=new FormData;t.append("image_upload",e),x.a.post("/posts/create",t,{headers:{"Content-Type":"multipart/form-data;boundary=1"}}).then((function(e){e.data&&e.data.success&&f.a.success(e.data.success)}))}}(s)),r(null),j(null)},children:"\u0412\u044b\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u043e\u0441\u0442!"}),Object(n.jsx)("hr",{}),Object(n.jsx)("h4",{children:"\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440!"}),Object(n.jsx)("img",{src:d,alt:s.name})]})]})]}):"Error"};var F=function(){var e=Object(m.d)((function(e){return e.user.isLogin})),t=Object(c.useState)(null),a=Object(l.a)(t,2),s=a[0],r=a[1],o=Object(c.useState)(null),i=Object(l.a)(o,2),d=i[0],j=i[1],b=Object(m.c)(),O=Object(c.useRef)(null);return e?Object(n.jsxs)(I.a,{children:[Object(n.jsx)("h3",{className:"modal-form-title",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440!"}),Object(n.jsxs)("div",{className:"modal-form-post",children:[Object(n.jsx)(u.a,{onClick:function(){O.current.click()},variant:"contained",color:"default",startIcon:Object(n.jsx)(B.a,{}),children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"}),Object(n.jsx)("input",{ref:O,style:{display:"none"},name:"upload_post",id:"upload_post",type:"file",onChange:function(e){var t=window.URL.createObjectURL(e.target.files[0]);r(e.target.files[0]),j(t)}}),d&&s&&Object(n.jsxs)("div",{className:"modal-form-post__preview",children:[Object(n.jsx)(u.a,{variant:"contained",color:"primary",startIcon:Object(n.jsx)(G.a,{}),onClick:function(){b(function(e){return function(t,a){if(a().user.isLogin){var n=new FormData;n.append("image_upload",e),x.a.post("/users/image/set",n,{headers:{"Content-Type":"multipart/form-data;boundary=1"}}).then((function(e){e.data&&e.data.success&&e.data.image&&(f.a.success(e.data.success),t({type:"SET_AVATAR",payload:e.data.image}),t((function(e,t){var a=t().modals;for(var n in a)a[n]=!1;e({type:"CLOSE_ALL",payload:a})})))}))}else f.a.error("\u0412\u044b \u043d\u0435 \u0432\u043e\u0448\u043b\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442!")}}(s)),r(null),j(null)},children:"\u041f\u043e\u043c\u0435\u043d\u044f\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440!"}),Object(n.jsx)("hr",{}),Object(n.jsx)("h4",{children:"\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440!"}),Object(n.jsx)("img",{src:d,alt:s.name})]})]})]}):"Error"},H=a(359),W=a(345),Y=a(46),z=L.a().shape({add_comment:L.c().required("\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c").min(1,"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c")});var J=Object(m.b)(null,(function(e){return{sendComment:function(t,a){return e(function(e){var t=e.postId,a=e.comment,n=e.resetValue;return function(e,c){var s=c().user,r=s.isLogin,o=s.user_info;r?x.a.post("/posts/comment",{postId:t,comment:a}).then((function(c){c.data&&(c.data.success&&(f.a.success(c.data.success),e({type:"SAVE_LAST_COMMENT",payload:{postId:t,newComment:{comment:a,name:o.nickname,id:c.data.id}}}),n()),c.data.error&&f.a.error(c.data.error))})):f.a.error("\u0412\u044b \u043d\u0435 \u0432\u043e\u0448\u043b\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442")}}(t))}}}))(Object(A.c)({mapPropsToValues:function(){return{add_comment:""}},handleSubmit:function(e,t){var a=t.props,n=t.resetForm,c={postId:a.postId,comment:e.add_comment,resetValue:n};a.sendComment(c)},validationSchema:z})((function(e){var t=e.lastComments,a=e.postId,s=e.isAllComments,r=e.scroll,o=Object(c.useState)(s),i=Object(l.a)(o,2),d=i[0],j=i[1],b=Object(m.c)(),O=Object(c.useRef)(null);Object(c.useEffect)((function(){if(r){var e=O.current;e.scrollTop=e.scrollHeight}}),[r]);var p=!1;return t&&(p=t.map((function(e){return Object(n.jsxs)("div",{className:"comments-comment",children:[Object(n.jsx)("span",{className:"comments-comment--name",children:e.name}),Object(n.jsx)("span",{className:"comments-comment--comment",children:e.comment})]},e.id)}))),Object(n.jsxs)("section",{className:"comments",children:[!!p.length&&!d&&Object(n.jsx)("span",{onClick:function(){j(!0),b(function(e){return function(t){x.a.post("/posts/comments",{postId:e}).then((function(a){a.data&&a.data.comments&&t({type:"SAVE_ALL_COMMENTS",payload:{comments:a.data.comments,postId:e}})}))}}(a))},className:"comments-loader",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438"}),!p.length&&Object(n.jsx)("p",{className:"comments-empty",children:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432 \u043d\u0435\u0442\u0443!"}),Object(n.jsx)("div",{className:"comments_users",ref:O,children:p}),Object(n.jsxs)(A.a,{noValidate:!0,autoComplete:"off",className:"comments-form",children:[Object(n.jsx)(D,{label:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",name:"add_comment",type:"text",classes:"comments-form__comment"}),Object(n.jsx)(u.a,{color:"primary",type:"submit",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})]})}))),X=a(4),$=a(346),K=a(347),Q=a(349),Z=a(348),ee=a(351),te=a(350),ae=a(66),ne=a.n(ae),ce=a(97),se=a.n(ce);a(290);var re=Object(W.a)((function(e){return{"@keyframes likeOnBg-anim":{"0%":{opacity:0,transform:"translate(-50%, -50%) scale(1)"},"100%":{opacity:1,transform:"translate(-50%, -50%) scale(3)"}},card:{marginBottom:"20px"},media:{height:0,paddingTop:"100%",cursor:"pointer"},like:{transition:".3s"},likeOnBg:{transition:".2s",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(1)",pointerEvents:"none",color:"#ff3b3bc2",opacity:0},likeOnBgActive:{animation:"$likeOnBg-anim 200ms linear",transform:"translate(-50%, -50%) scale(3)",opacity:1},likeActive:{color:"#ff3b3b"},content:{padding:0,position:"relative"},formodal:{flex:1,alignItems:"flex-end"}}}));function oe(e){var t=e.id,a=e.likes,r=e.image,o=e.user,i=e.liked,u=e.children,d=e.date,j=e.props_classes,b=se()(d).format("DD MMMM YYYY HH:mm"),O=re(),p=Object(m.c)(),h=Object(m.d)((function(e){return e.user.isLogin})),g=s.a.useState(i),v=Object(l.a)(g,2),y=v[0],_=v[1],E=s.a.useState(!1),C=Object(l.a)(E,2),A=C[0],L=C[1],k=s.a.useState(a),N=Object(l.a)(k,2),T=N[0],I=N[1];Object(c.useEffect)((function(){if(A){var e=setInterval((function(){L(!1)}),1500);return function(){return clearInterval(e)}}}),[A]);var w=function(e){var a,n;h&&I(e?T-1:T+1),p((a=t,n=!e,function(e,t){t().user.isLogin?x.a.post("/posts/like",{postId:a,isLike:n}).then((function(e){e.data&&e.data.error&&f.a.error(e.data.error)})):f.a.error("\u0412\u044b \u043d\u0435 \u0432\u043e\u0448\u043b\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442!")}))};return Object(n.jsxs)($.a,{className:[O.card,j].join(" "),children:[Object(n.jsxs)("div",{className:O.formodal,children:[Object(n.jsx)(K.a,{avatar:Object(n.jsx)(S.a,{"aria-label":"recipe",src:o.image,className:"avatar",children:o.nickname[0]}),title:o.nickname,subheader:b}),Object(n.jsxs)(Z.a,{className:O.content,children:[Object(n.jsx)(Q.a,{className:O.media,onDoubleClick:function(){h&&(!0!==y&&w(y,!0),_(!0),L(!0))},image:r}),Object(n.jsx)(te.a,{className:Object(X.a)(O.likeOnBg,Object(Y.a)({},O.likeOnBgActive,A)),children:Object(n.jsx)(ne.a,{})})]}),Object(n.jsxs)(ee.a,{disableSpacing:!0,children:[Object(n.jsx)(te.a,{"aria-label":"add to favorites",className:Object(X.a)(O.like,Object(Y.a)({},O.likeActive,y)),onClick:function(){h&&_(!y),w(y)},"aria-expanded":y,children:Object(n.jsx)(ne.a,{})}),Object(n.jsxs)("span",{children:[T,' \u043e\u0442\u043c\u0435\u0442\u043e\u043a "\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f"']})]})]}),Object(n.jsx)(ee.a,{className:O.formodal,disableSpacing:!0,children:u})]})}var ie=function(){return Object(n.jsx)("div",{className:"loader",children:Object(n.jsxs)("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",children:[Object(n.jsx)("circle",{cx:"50",cy:"50",r:"32",strokeWidth:"8",stroke:"#000000",strokeDasharray:"50.26548245743669 50.26548245743669",fill:"none",strokeLinecap:"round",children:Object(n.jsx)("animateTransform",{attributeName:"transform",type:"rotate",dur:"1s",repeatCount:"indefinite",keyTimes:"0;1",values:"0 50 50;360 50 50"})}),Object(n.jsx)("circle",{cx:"50",cy:"50",r:"23",strokeWidth:"8",stroke:"#d0d0d0",strokeDasharray:"36.12831551628262 36.12831551628262",strokeDashoffset:"36.12831551628262",fill:"none",strokeLinecap:"round",children:Object(n.jsx)("animateTransform",{attributeName:"transform",type:"rotate",dur:"1s",repeatCount:"indefinite",keyTimes:"0;1",values:"0 50 50;-360 50 50"})})]})})},le=Object(W.a)((function(e){return{wrap:Object(Y.a)({display:"flex"},e.breakpoints.down("620"),{flexDirection:"column"}),wrapComments:Object(Y.a)({display:"block"},e.breakpoints.down("620"),{display:"none"})}}));var ue=function(){var e=Object(c.useState)(!0),t=Object(l.a)(e,2),a=t[0],s=t[1],r=Object(m.d)((function(e){return e.posts.activePostDetails})),o=le();return Object(c.useEffect)((function(){r&&s(!1)}),[r]),a?Object(n.jsx)(ie,{}):Object(n.jsx)(oe,Object(y.a)(Object(y.a)({},r),{},{props_classes:o.wrap,children:Object(n.jsx)("div",{className:o.wrapComments,children:Object(n.jsx)(J,{scroll:!0,postId:r.id,lastComments:r.lastComments,isAllComments:!0})})}))},de=Object(W.a)((function(e){return{paper:{position:"absolute",background:"linear-gradient(135deg, #000 50%, #fff 50%)",boxShadow:e.shadows[5],padding:e.spacing(2,4,3),width:"100%",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}}));function je(){var e=Object(m.c)(),t=Object(m.d)((function(e){return e.modals.active})),a=Object(m.d)((function(e){return e.modals.register})),c=Object(m.d)((function(e){return e.modals.login})),s=Object(m.d)((function(e){return e.modals.uploadPost})),r=Object(m.d)((function(e){return e.modals.uploadUserAvatar})),o=Object(m.d)((function(e){return e.modals.postDetails})),i=de(),l={maxWidth:400};o&&(l.maxWidth=1e3,l.maxHeight=660);var u=function(t){e((function(e,t){var a=t().modals;for(var n in a)a[n]=!1;e({type:"CLOSE_ALL",payload:a})})),t&&e({type:"DEL_ACTIVATE_POST"})};return Object(n.jsx)(H.a,{open:t,onClose:function(){return u(o)},children:Object(n.jsx)(I.a,{className:i.paper,style:Object(y.a)({},l),children:Object(n.jsxs)("section",{className:"modal",children:[Object(n.jsx)("span",{className:"modal__close",onClick:u}),a&&Object(n.jsx)(V,{}),c&&Object(n.jsx)(U,{}),s&&Object(n.jsx)(q,{}),r&&Object(n.jsx)(F,{}),o&&Object(n.jsx)(ue,{})]})})})}var be=Object(c.memo)(je),Oe=a(15),me=a(148),pe=a(339),fe=a(47),he=function(e,t,a){return function(n,c){var s=c().user.isLogin,r=t?"unsub":"sub";s&&e&&x.a.post("/subs/action/".concat(r),{userId:e}).then((function(e){e.data&&(e.data.error&&f.a.error(e.data.error),e.data.sub&&a(!t))}))}},xe=a(296),ge=a(354),ve=a(353),ye=a(352),_e=a(149),Se=a.n(_e),Ee=a(150),Ce=a.n(Ee),Ae=Object(W.a)((function(){return{button:{minWidth:"inherit"},link:{width:"100%",display:"flex",alignItems:"center"}}})),Le=function(e){var t,a,s=e.image,r=e.nickname,o=e.togglePoint,i=e._id,d=e.isSubs,j=Object(c.useState)(d||!1),b=Object(l.a)(j,2),O=b[0],p=b[1],f=Ae(),h=Object(m.c)();O?(t="\u041e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f",a=Object(n.jsx)(Ce.a,{})):(t="\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f",a=Object(n.jsx)(Se.a,{}));return Object(n.jsxs)(xe.a,{button:!0,children:[Object(n.jsxs)(E.b,{className:f.link,to:"/user/".concat(i),children:[Object(n.jsx)(ye.a,{children:Object(n.jsx)(S.a,{"aria-label":"recipe",src:s,className:"avatar",children:r[0]})}),Object(n.jsx)(ve.a,{primary:r})]}),Object(n.jsx)(ge.a,{children:Object(n.jsxs)(u.a,{onClick:function(){h(he(i,O,p))},variant:"contained",className:f.button,color:"secondary",children:[!o&&t,o&&a]})})]})},ke=Object(W.a)((function(e){return{root:{width:"100%",backgroundColor:e.palette.background.paper,border:"1px solid #000",marginBottom:"5px",maxHeight:"140px",overflowX:"auto"}}}));var Ne=function(e){var t=e.togglePoint,a=ke(),s=Object(m.c)(),r=Object(m.d)((function(e){return e.subs.user_subs})),o=Object(m.d)((function(e){return e.subs.isLoadingSub})),i=Object(m.d)((function(e){return e.user.isLogin}));Object(c.useEffect)((function(){!r.length&&o&&s((function(e,t){t().user.isLogin&&x.a.post("/subs/get").then((function(t){t.data&&t.data.subs&&e({type:"SAVE_SUBS",payload:t.data.subs})}))}))}),[s,r,o,i]);var l=r.map((function(e){return Object(n.jsx)(Le,Object(y.a)({isSubs:!0,togglePoint:t},e),e._id)}));return!r.length&&o?Object(n.jsx)(ie,{}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(fe.a,{variant:"h6",children:"\u0412\u0430\u0448\u0438 \u043f\u043e\u0434\u043f\u0438\u0441\u043a\u0438:"}),Object(n.jsxs)(pe.a,{dense:!0,className:a.root,children:[l,!o&&!r.length&&Object(n.jsx)("p",{className:"center",children:"\u0412\u044b \u043d\u0438\u043d\u0430\u043a\u043e\u0433\u043e \u043d\u0435 \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d\u044b :("})]})]})},Te=Object(W.a)((function(e){return{root:{width:"100%",backgroundColor:e.palette.background.paper,border:"1px solid #000",marginBottom:"5px",maxHeight:"140px",overflowX:"auto"}}}));var Ie=function(e){var t=e.togglePoint,a=Te(),s=Object(m.c)(),r=Object(m.d)((function(e){return e.subs.recomends_subs})),o=Object(m.d)((function(e){return e.subs.isLoadingRec})),i=Object(m.d)((function(e){return e.user.isLogin}));Object(c.useEffect)((function(){!r.length&&o&&s((function(e,t){t().user.isLogin&&x.a.post("/subs/recomends").then((function(t){t.data&&t.data.subs&&e({type:"GET_RECOMEND_SUBS",payload:t.data.subs})}))}))}),[s,r,o,i]);var l=r.map((function(e){return Object(n.jsx)(Le,Object(y.a)({togglePoint:t},e),e._id)}));return!r.length&&o?Object(n.jsx)(ie,{}):Object(n.jsx)(n.Fragment,{children:!o&&!!r.length&&Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(fe.a,{variant:"h6",children:"\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0435:"}),Object(n.jsx)(pe.a,{dense:!0,className:a.root,children:l})]})})},we=function(e){var t=Object(c.useState)(null),a=Object(l.a)(t,2),n=a[0],s=a[1];return Object(c.useEffect)((function(){var t={},a=Object.keys(e),n=!1,c=function(){var e=a.reduce((function(e,a){return e[a]=!(!t[a]||!t[a].matches),e}),{});s(e)};if(window&&window.matchMedia){var r={};a.forEach((function(a){"string"===typeof e[a]?(t[a]=window.matchMedia(e[a]),r[a]=t[a].matches):r[a]=!1})),s(r),n=!0,a.forEach((function(a){"string"===typeof e[a]&&t[a].addListener(c)}))}return function(){n&&a.forEach((function(a){"string"===typeof e[a]&&t[a].removeListener(c)}))}}),[e]),n};var Pe=function(e){var t=e.queries,a=Object(m.c)(),s=Object(m.d)((function(e){return e.posts.posts})),r=Object(m.d)((function(e){return e.posts.hasMore})),o=Object(m.d)((function(e){return e.user.isLogin}));Object(c.useEffect)((function(){s.length||a(g())}),[s,a]);var i=s.map((function(e,t){return Object(n.jsx)(oe,Object(y.a)(Object(y.a)({},s[t]),{},{children:Object(n.jsx)(J,{lastComments:e.lastComment,postId:e.id})}),e.id)})),l=we(t);return Object(n.jsxs)("section",{className:"home-container",children:[Object(n.jsx)("div",{className:"posts".concat(o?"":"-max"),children:Object(n.jsx)(me.a,{dataLength:s.length,next:function(){return a(g())},hasMore:r,endMessage:Object(n.jsx)("p",{className:"center",children:"\u041f\u043e\u0441\u0442\u043e\u0432 \u043d\u0435\u0442\u0443 :("}),loader:Object(n.jsx)(ie,{}),children:i})}),o&&Object(n.jsxs)("div",{className:"subs",children:[Object(n.jsx)(Ne,{togglePoint:!!l&&l.toggle}),Object(n.jsx)(Ie,{togglePoint:!!l&&l.toggle})]})]})},De=a(102),Ve=a.n(De),Me=a(151),Re=a(356),Ue=a(152),Be=a.n(Ue),Ge=a(355),qe=Object(W.a)((function(e){return{root:{height:"auto"}}}));var Fe=function(e){var t=qe();return Object(n.jsx)(Ge.a,Object(y.a)(Object(y.a)({},e),{},{style:Object(y.a)(Object(y.a)({},e.style),{},{height:"auto",padding:"5px"}),className:t.root}))},He=Object(W.a)((function(e){return{root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",backgroundColor:e.palette.background.paper},img:{width:"100%",maxHeight:"280px",height:"100%"},list:{width:"100%"},details:{position:"absolute",background:"#1a191991",zIndex:1,width:"100%",height:"100%",top:0,left:0,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",color:"#fff",fontSize:"20px",transition:".3s",opacity:0,cursor:"pointer","&:hover":{opacity:1}}}}));var We=function(e){var t=e.userId,a=e.togglePoint,s=He(),r=Object(c.useState)([]),o=Object(l.a)(r,2),i=o[0],u=o[1],d=Object(c.useState)(!0),j=Object(l.a)(d,2),b=j[0],O=j[1],p=function(){var e=Object(Me.a)(Ve.a.mark((function e(t){var a;return Ve.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.post("/users/posts",{userId:t});case 2:(a=e.sent).data&&(a.data.error&&f.a.error(a.data.error),a.data.posts&&(u(a.data.posts),O(!1)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=Object(m.c)();if(Object(c.useEffect)((function(){b&&p(t)}),[t,b]),b)return Object(n.jsx)(ie,{});var g=a?3:2;return Object(n.jsxs)("div",{className:s.root,children:[!!i.length&&Object(n.jsx)(Re.a,{cols:g,className:s.list,children:i.map((function(e){return Object(n.jsxs)(Fe,{cols:1,onClick:function(){return t=e._id,void h(v(t));var t},children:[Object(n.jsxs)("div",{className:s.details,children:[Object(n.jsxs)("span",{children:[e.likes,Object(n.jsx)(ne.a,{})]}),Object(n.jsxs)("span",{children:[e.comments,Object(n.jsx)(Be.a,{}),"   "]})]}),Object(n.jsx)("img",{className:s.img,src:e.image,alt:"Post \u2116"+e._id})]},e._id)}))}),!i.length&&Object(n.jsx)("h4",{className:"empty",children:"\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0435\u0449\u0451 \u043d\u0435\u0442 \u043f\u043e\u0441\u0442\u043e\u0432!"})]})},Ye=Object(W.a)((function(e){return{header:{width:"100%",backgroundColor:e.palette.background.paper,marginBottom:"5px",display:"flex"},avatar:{width:"100px",height:"100px",fontSize:"40px"},second:{marginLeft:"30px"}}}));var ze=function(e){var t=e.userId,a=Object(c.useState)([]),s=Object(l.a)(a,2),r=s[0],o=s[1],i=Object(c.useState)(!0),d=Object(l.a)(i,2),j=d[0],b=d[1],O=Object(c.useState)(!1),p=Object(l.a)(O,2),h=p[0],g=p[1],v=Object(m.d)((function(e){return e.user.user_info}));Object(c.useEffect)((function(){!function(e){x.a.post("/subs/info",{userId:e}).then((function(e){e.data&&(e.data.error&&f.a.error(e.data.error),e.data.info&&(o(e.data.info),g(e.data.info.isSub),b(!1)))}))}(t)}),[t]);var y,_=r.nickname,E=r.image,C=Ye(),A=Object(m.c)();return j?Object(n.jsx)(ie,{}):(y=h?"\u041e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f":"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f",Object(n.jsxs)("section",{className:C.header,children:[Object(n.jsx)(S.a,{"aria-label":"recipe",src:E,className:"avatar ".concat(C.avatar),children:_[0]}),Object(n.jsxs)("div",{className:C.second,children:[Object(n.jsx)(fe.a,{variant:"h3",children:_}),v._id!==t&&Object(n.jsx)(u.a,{variant:"contained",color:"secondary",onClick:function(){A(he(t,h,g))},children:y})]})]}))};var Je=function(e){var t=e.match,a=e.queries,c=t.params.userId,s=we(a);return Object(n.jsxs)("section",{className:"user-container",children:[Object(n.jsx)(ze,{userId:c}),Object(n.jsx)(We,{togglePoint:!!s&&s.toggleCols,userId:c})]})},Xe={toggle:"(max-width: 930px)",toggleCols:"(min-width: 500px)"},$e=function(e){var t=e.authenticated,a=Object(w.a)(e,["authenticated"]);return t?Object(n.jsx)(Oe.b,Object(y.a)({},a)):Object(n.jsx)(Oe.a,{to:"/"})},Ke=function(){var e=Object(m.d)((function(e){return e.user.isAuth}));return Object(n.jsxs)(Oe.d,{children:[Object(n.jsx)(Oe.b,{exact:!0,path:"/",children:Object(n.jsx)(Pe,{queries:Xe})}),Object(n.jsx)(Oe.d,{children:Object(n.jsx)($e,{authenticated:e,exact:!0,path:"/user/:userId",render:function(e){return Object(n.jsx)(Je,Object(y.a)(Object(y.a)({},e),{},{queries:Xe}))}})})]})},Qe=function(){return Object(n.jsxs)(i.a,{maxWidth:"md",children:[Object(n.jsx)(C,{}),Object(n.jsx)(Ke,{}),Object(n.jsx)(be,{})]})},Ze=a(45),et={posts:[],page:1,hasMore:!0,activePostDetails:null},tt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_POSTS":return Object(y.a)(Object(y.a)({},e),{},{posts:t.payload,page:e.page+1});case"UPLOAD_IMAGE":return Object(y.a)(Object(y.a)({},e),{},{selectedFile:null});case"SAVE_HAS_MORE":return Object(y.a)(Object(y.a)({},e),{},{hasMore:t.payload});case"SAVE_ALL_COMMENTS":var a=e.posts.map((function(e){var a=Object(y.a)({},e);return a.id===t.payload.postId&&(a.lastComment=t.payload.comments),a}));return Object(y.a)(Object(y.a)({},e),{},{posts:a});case"SAVE_LAST_COMMENT":var n=e.posts.map((function(e){var a=Object(y.a)({},e);return a.id===t.payload.postId&&a.lastComment.push(t.payload.newComment),a}));return Object(y.a)(Object(y.a)({},e),{},{posts:n});case"DELETE_POSTS":return{hasMore:!0,posts:[],page:1,activePostDetails:null};case"ACTIVATE_POST":return Object(y.a)(Object(y.a)({},e),{},{activePostDetails:t.payload});case"DEL_ACTIVATE_POST":return Object(y.a)(Object(y.a)({},e),{},{activePostDetails:null});default:return e}},at={user_info:[],isLogin:!1,isAuth:localStorage.getItem("isAuth")||!1},nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SEND_LOGIN":var a=Object.assign({},t.payload);return localStorage.setItem("isAuth",!0),{user_info:a,isLogin:!0,isAuth:!0};case"SEND_LOGOUT":return localStorage.removeItem("isAuth"),{user_info:[],isLogin:!1,isAuth:!1};case"SET_AVATAR":return Object(y.a)(Object(y.a)({},e),{},{user_info:Object(y.a)(Object(y.a)({},e.user_info),{},{image:t.payload})});default:return e}},ct={active:!1,login:!1,register:!1,uploadPost:!1,uploadUserAvatar:!1,postDetails:!1},st=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ct,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLOSE_ALL":return Object(y.a)({},t.payload);case"ACTIVE_REGISTER":return Object(y.a)(Object(y.a)({},e),{},{register:!0,active:!0});case"ACTIVE_LOGIN":return Object(y.a)(Object(y.a)({},e),{},{login:!0,active:!0});case"ACTIVE_UPLOAD_POST":return Object(y.a)(Object(y.a)({},e),{},{uploadPost:!0,active:!0});case"ACTIVE_UPLOAD_USER_AVATAR":return Object(y.a)(Object(y.a)({},e),{},{uploadUserAvatar:!0,active:!0});case"ACTIVE_POST_DETAILS":return Object(y.a)(Object(y.a)({},e),{},{postDetails:!0,active:!0});default:return e}},rt={recomends_subs:[],user_subs:[],isLoadingRec:!0,isLoadingSub:!0},ot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_RECOMEND_SUBS":return Object(y.a)(Object(y.a)({},e),{},{recomends_subs:t.payload,isLoadingRec:!1});case"SAVE_SUBS":return Object(y.a)(Object(y.a)({},e),{},{user_subs:t.payload,isLoadingSub:!1});case"CLEAR_SUBS":return Object(y.a)({},rt);default:return e}},it=Object(Ze.c)({posts:tt,user:nt,modals:st,subs:ot}),lt=a(153),ut=Object(Ze.e)(it,Object(Ze.d)(Object(Ze.a)(lt.a)));o.a.render(Object(n.jsx)(m.a,{store:ut,children:Object(n.jsx)(E.a,{children:Object(n.jsx)(Qe,{})})}),document.getElementById("root"))}},[[293,1,2]]]);
//# sourceMappingURL=main.8f64c95f.chunk.js.map